<!DOCTYPE html>
<html>
<head>
    <title>CSS Migration Diagnostic Tool</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .diagnostic { margin: 20px 0; padding: 15px; background: white; border-radius: 5px; }
        .success { border-left: 4px solid #4CAF50; }
        .warning { border-left: 4px solid #FF9800; }
        .error { border-left: 4px solid #F44336; }
        .result { margin: 10px 0; }
        pre { background: #f9f9f9; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .issues-list { max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; }
    </style>
</head>
<body>
    <h1>🔍 CSS Migration Diagnostic Tool</h1>
    
    <div class="diagnostic">
        <h2>Quick Actions</h2>
        <button onclick="runFullDiagnostic()">🚀 Run Full Diagnostic</button>
        <button onclick="detectUnstyledElements()">🎨 Find Unstyled Elements</button>
        <button onclick="analyzeCSSCoverage()">📊 Analyze CSS Coverage</button>
        <button onclick="validateImportChain()">🔗 Validate Import Chain</button>
        <button onclick="compareWithOriginal()">⚖️ Compare with Original</button>
    </div>

    <div id="results"></div>

    <script>
        const siteURL = 'https://p.weaver-yuwono.com';
        
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `diagnostic ${type}`;
            div.innerHTML = `<div class="result">${message}</div>`;
            results.appendChild(div);
        }

        async function runFullDiagnostic() {
            document.getElementById('results').innerHTML = '';
            log('🚀 Starting Full CSS Migration Diagnostic...', 'info');
            
            await validateImportChain();
            await analyzeCSSCoverage();
            await detectUnstyledElements();
            await compareWithOriginal();
            
            log('✅ Full diagnostic complete!', 'success');
        }

        async function validateImportChain() {
            log('🔗 Validating CSS Import Chain...', 'info');
            
            const importTests = [
                'css/main.css',
                'css/base/_reset.css',
                'css/base/_variables.css', 
                'css/base/_typography.css',
                'css/components/_layout.css',
                'css/components/_buttons.css',
                'css/components/_forms.css',
                'css/components/_sidebar.css',
                'css/components/_cards.css',
                'css/components/_popups.css'
            ];

            let passed = 0;
            let failed = 0;
            
            for (const file of importTests) {
                try {
                    const response = await fetch(`${siteURL}/${file}`);
                    if (response.ok) {
                        const text = await response.text();
                        if (text.length > 50) {
                            log(`✅ ${file} - ${text.length} chars`, 'success');
                            passed++;
                        } else {
                            log(`⚠️ ${file} - File too small (${text.length} chars)`, 'warning');
                            failed++;
                        }
                    } else {
                        log(`❌ ${file} - HTTP ${response.status}`, 'error');
                        failed++;
                    }
                } catch (error) {
                    log(`❌ ${file} - ${error.message}`, 'error');
                    failed++;
                }
            }
            
            log(`📊 Import Chain Results: ${passed} passed, ${failed} failed`, passed > failed ? 'success' : 'error');
        }

        function detectUnstyledElements() {
            log('🎨 Detecting Unstyled Elements...', 'info');
            
            // Redirect to actual site for testing
            const testURL = `${siteURL}/`;
            log(`🌐 Opening site for element testing: <a href="${testURL}" target="_blank">${testURL}</a>`, 'info');
            log(`📋 Copy this script to run in the site's console:`, 'warning');
            
            const script = `
// Paste this in the browser console on ${siteURL}
function detectUnstyledElements() {
    const issues = [];
    
    // Check for elements with default browser styling
    document.querySelectorAll('*').forEach(el => {
        const computed = getComputedStyle(el);
        
        // Detect unstyled buttons
        if (el.tagName === 'BUTTON' && computed.backgroundColor === 'rgb(239, 239, 239)') {
            issues.push({element: el, issue: 'Default button styling', tag: el.tagName, class: el.className});
        }
        
        // Detect unstyled forms
        if (el.tagName === 'INPUT' && computed.border === '2px inset rgb(118, 118, 118)') {
            issues.push({element: el, issue: 'Default input styling', tag: el.tagName, class: el.className});
        }
        
        // Detect missing custom fonts
        if (computed.fontFamily.includes('serif') && !computed.fontFamily.includes('Playfair')) {
            if (el.innerText && el.innerText.trim().length > 0) {
                issues.push({element: el, issue: 'Using default serif font', tag: el.tagName, class: el.className});
            }
        }
        
        // Detect elements with classes but no apparent styling
        if (el.className && el.className.length > 0 && 
            computed.backgroundColor === 'rgba(0, 0, 0, 0)' &&
            computed.color === 'rgb(0, 0, 0)' &&
            computed.margin === '0px' &&
            computed.padding === '0px' &&
            !el.style.cssText) {
            issues.push({element: el, issue: 'Has classes but appears unstyled', tag: el.tagName, class: el.className});
        }
    });
    
    console.log('🎨 Unstyled Elements Found:', issues.length);
    console.table(issues.map(i => ({
        tag: i.tag,
        classes: i.class,
        issue: i.issue
    })));
    
    return issues;
}

// Run the detection
detectUnstyledElements();
`;
            
            log(`<pre>${script}</pre>`, 'info');
        }

        async function analyzeCSSCoverage() {
            log('📊 Analyzing CSS Coverage...', 'info');
            
            try {
                const response = await fetch(`${siteURL}/css/main.css`);
                const css = await response.text();
                
                // Count @import statements
                const imports = css.match(/@import[^;]+;/g) || [];
                log(`📁 Found ${imports.length} @import statements`, 'info');
                
                // Estimate total CSS size
                let totalSize = css.length;
                log(`📏 Main CSS file size: ${totalSize} bytes`, 'info');
                
                // Test if imports are working by checking for specific selectors
                const testSelectors = [
                    '.sidebar',
                    '.field', 
                    '.button',
                    '.w-layout-layout',
                    '.block-link'
                ];
                
                log('🔍 Testing key selector availability on live site...', 'info');
                
                const selectorScript = `
// Test script for ${siteURL} console
const testSelectors = ${JSON.stringify(testSelectors)};
const results = {};

testSelectors.forEach(selector => {
    const elements = document.querySelectorAll(selector);
    const hasStyle = elements.length > 0 && getComputedStyle(elements[0]).backgroundColor !== 'rgba(0, 0, 0, 0)';
    results[selector] = {
        found: elements.length,
        styled: hasStyle
    };
});

console.log('🔍 Selector Test Results:');
console.table(results);
`;
                
                log(`📋 Run this in ${siteURL} console:`, 'warning');
                log(`<pre>${selectorScript}</pre>`, 'info');
                
            } catch (error) {
                log(`❌ Failed to analyze CSS: ${error.message}`, 'error');
            }
        }

        async function compareWithOriginal() {
            log('⚖️ Comparing with Original CSS Structure...', 'info');
            
            const expectedFiles = {
                'css/main.css': { minSize: 500, description: 'Main import hub' },
                'css/base/_variables.css': { minSize: 300, description: 'CSS custom properties' },
                'css/base/_typography.css': { minSize: 1000, description: 'Typography rules' },
                'css/components/_sidebar.css': { minSize: 2000, description: 'Sidebar navigation' },
                'css/components/_forms.css': { minSize: 500, description: 'Form elements' },
                'css/components/_buttons.css': { minSize: 300, description: 'Button styles' }
            };
            
            let totalSize = 0;
            let filesChecked = 0;
            
            for (const [file, config] of Object.entries(expectedFiles)) {
                try {
                    const response = await fetch(`${siteURL}/${file}`);
                    if (response.ok) {
                        const content = await response.text();
                        totalSize += content.length;
                        filesChecked++;
                        
                        if (content.length >= config.minSize) {
                            log(`✅ ${file} - ${content.length} bytes (${config.description})`, 'success');
                        } else {
                            log(`⚠️ ${file} - Only ${content.length} bytes, expected >${config.minSize} (${config.description})`, 'warning');
                        }
                    } else {
                        log(`❌ ${file} - Not found (${config.description})`, 'error');
                    }
                } catch (error) {
                    log(`❌ ${file} - Error: ${error.message}`, 'error');
                }
            }
            
            log(`📊 Total CSS Size: ${totalSize} bytes across ${filesChecked} files`, totalSize > 50000 ? 'success' : 'warning');
            
            // Original structure comparison
            log('📋 Original vs New Structure Comparison:', 'info');
            log(`
<pre>
BEFORE MIGRATION:
- normalize.css    (~6KB)
- components.css   (~37KB) 
- gptp.css         (~30KB)
- hamburger-menu.css (~3KB)
Total: ~76KB in 4 files

AFTER MIGRATION:
- main.css + imports (~${Math.round(totalSize/1024)}KB)
- Modular structure: ${filesChecked} component files
- Expected: Similar total size, better organization
</pre>`, 'info');
        }
        
        // Auto-run basic diagnostic on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('🔧 CSS Migration Diagnostic Tool Loaded', 'success');
            log('👆 Click buttons above to run specific tests', 'info');
        });
    </script>
</body>
</html>