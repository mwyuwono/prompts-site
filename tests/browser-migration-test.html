<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSS Migration Browser Testing</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .test-header {
      text-align: center;
      margin-bottom: 40px;
    }
    .test-section {
      margin-bottom: 40px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .test-results {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      margin-top: 15px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
    }
    .test-button {
      background: #007cba;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .test-button:hover {
      background: #005a87;
    }
    .test-button.running {
      background: #ffa500;
      cursor: not-allowed;
    }
    .test-button.success {
      background: #28a745;
    }
    .test-button.failed {
      background: #dc3545;
    }
    .status {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status.pending { background: #6c757d; }
    .status.running { background: #ffa500; }
    .status.success { background: #28a745; }
    .status.failed { background: #dc3545; }
    .summary {
      background: #e3f2fd;
      padding: 20px;
      border-radius: 6px;
      margin-bottom: 30px;
    }
    .element-comparison {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 15px;
    }
    .comparison-box {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
    }
    .comparison-box h4 {
      margin-top: 0;
      color: #495057;
    }
    .property-diff {
      padding: 5px;
      margin: 2px 0;
    }
    .property-diff.same {
      background: #d4edda;
    }
    .property-diff.different {
      background: #f8d7da;
    }
    .iframe-container {
      margin: 20px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    .iframe-container iframe {
      width: 100%;
      height: 400px;
      border: none;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>üî¨ CSS Migration Quality Testing</h1>
      <p>Comprehensive browser-based testing for CSS migration validation</p>
    </div>

    <div class="summary" id="summary">
      <h3>Test Summary</h3>
      <p>Click "Run All Tests" to begin comprehensive migration quality testing.</p>
    </div>

    <div class="test-section">
      <h3>üéØ Quick Actions</h3>
      <button class="test-button" onclick="runAllTests()">Run All Tests</button>
      <button class="test-button" onclick="testComputedStyles()">Test Computed Styles</button>
      <button class="test-button" onclick="testResponsiveDesign()">Test Responsive Design</button>
      <button class="test-button" onclick="testInteractions()">Test Interactions</button>
      <button class="test-button" onclick="clearResults()">Clear Results</button>
    </div>

    <div class="test-section">
      <h3><span class="status pending" id="status-computed"></span>Computed Styles Validation</h3>
      <p>Compares computed styles of critical elements to detect visual regressions.</p>
      <button class="test-button" onclick="testComputedStyles()">Run Computed Styles Test</button>
      <div class="test-results" id="computed-results"></div>
    </div>

    <div class="test-section">
      <h3><span class="status pending" id="status-responsive"></span>Responsive Design Testing</h3>
      <p>Tests layout behavior across different viewport sizes.</p>
      <button class="test-button" onclick="testResponsiveDesign()">Run Responsive Test</button>
      <div class="test-results" id="responsive-results"></div>
    </div>

    <div class="test-section">
      <h3><span class="status pending" id="status-interactions"></span>Interactive Elements Testing</h3>
      <p>Validates hover states, focus states, and interactive behaviors.</p>
      <button class="test-button" onclick="testInteractions()">Run Interactions Test</button>
      <div class="test-results" id="interaction-results"></div>
    </div>

    <div class="test-section">
      <h3><span class="status pending" id="status-performance"></span>Performance Analysis</h3>
      <p>Analyzes CSS load times and rendering performance.</p>
      <button class="test-button" onclick="testPerformance()">Run Performance Test</button>
      <div class="test-results" id="performance-results"></div>
    </div>

    <div class="test-section">
      <h3><span class="status pending" id="status-visual"></span>Visual Comparison</h3>
      <p>Side-by-side comparison of pages with before/after migration.</p>
      <button class="test-button" onclick="setupVisualComparison()">Setup Visual Comparison</button>
      <div id="visual-comparison-container"></div>
    </div>
  </div>

  <script>
    // Critical elements to test
    const CRITICAL_ELEMENTS = [
      { selector: '.page-wrap', description: 'Main page container' },
      { selector: '.left-panel', description: 'Sidebar panel' },
      { selector: '.right-panel', description: 'Main content area' },
      { selector: '.sidebar-section-head', description: 'Sidebar section headers' },
      { selector: '.tab', description: 'Navigation tabs' },
      { selector: '.hamburger-menu', description: 'Mobile hamburger menu' },
      { selector: 'h1', description: 'Main headings' },
      { selector: '.field', description: 'Form input fields' },
      { selector: '.copy-btn', description: 'Copy buttons' },
      { selector: '.block-link', description: 'Service links' }
    ];

    const CSS_PROPERTIES = [
      'color', 'background-color', 'font-family', 'font-size', 'font-weight',
      'margin-top', 'margin-bottom', 'padding-top', 'padding-bottom',
      'border-width', 'border-color', 'border-radius', 'width', 'height',
      'display', 'flex-direction', 'justify-content', 'align-items',
      'position', 'z-index', 'opacity'
    ];

    const VIEWPORTS = [
      { name: 'Desktop', width: 1920, height: 1080 },
      { name: 'Tablet', width: 768, height: 1024 },
      { name: 'Mobile', width: 375, height: 812 }
    ];

    let testResults = {
      computedStyles: null,
      responsive: null,
      interactions: null,
      performance: null,
      visual: null
    };

    async function runAllTests() {
      updateSummary('Running comprehensive migration quality tests...');
      
      await testComputedStyles();
      await testResponsiveDesign();
      await testInteractions();
      await testPerformance();
      
      generateFinalReport();
    }

    async function testComputedStyles() {
      setTestStatus('computed', 'running');
      const results = document.getElementById('computed-results');
      results.innerHTML = 'Testing computed styles...\n';

      try {
        let passed = 0;
        let failed = 0;
        let total = 0;
        let details = [];

        for (const element of CRITICAL_ELEMENTS) {
          const elements = document.querySelectorAll(element.selector);
          if (elements.length === 0) {
            details.push(`‚ùå Element not found: ${element.selector} (${element.description})`);
            failed++;
            total++;
            continue;
          }

          for (const el of elements) {
            const computedStyles = window.getComputedStyle(el);
            let elementPassed = true;
            let elementDetails = [];

            for (const prop of CSS_PROPERTIES) {
              const value = computedStyles.getPropertyValue(prop);
              if (value && value !== 'initial' && value !== 'auto') {
                elementDetails.push(`  ${prop}: ${value}`);
              } else if (['color', 'background-color', 'font-family', 'font-size'].includes(prop)) {
                elementDetails.push(`  ‚ö†Ô∏è ${prop}: ${value || 'undefined'}`);
                elementPassed = false;
              }
            }

            if (elementPassed) {
              details.push(`‚úÖ ${element.selector}: ${element.description}`);
              details.push(...elementDetails.slice(0, 5)); // Show first 5 properties
              passed++;
            } else {
              details.push(`‚ùå ${element.selector}: Missing critical styles`);
              details.push(...elementDetails);
              failed++;
            }
            total++;
            break; // Test only first element of each type
          }
        }

        testResults.computedStyles = { passed, failed, total, details };
        
        results.innerHTML = `COMPUTED STYLES TEST RESULTS:
========================================
‚úÖ Passed: ${passed}
‚ùå Failed: ${failed}  
üìä Total: ${total}
üìà Success Rate: ${((passed/total)*100).toFixed(1)}%

DETAILS:
${details.join('\n')}`;

        setTestStatus('computed', failed === 0 ? 'success' : 'failed');

      } catch (error) {
        results.innerHTML = `‚ùå Error testing computed styles: ${error.message}`;
        setTestStatus('computed', 'failed');
      }
    }

    async function testResponsiveDesign() {
      setTestStatus('responsive', 'running');
      const results = document.getElementById('responsive-results');
      results.innerHTML = 'Testing responsive design...\n';

      try {
        let testsPassed = 0;
        let testsFailed = 0;
        let details = [];

        for (const viewport of VIEWPORTS) {
          details.push(`\nüì± Testing ${viewport.name} (${viewport.width}x${viewport.height}):`);
          
          // Simulate viewport change
          const originalWidth = window.innerWidth;
          const originalHeight = window.innerHeight;
          
          // Note: Can't actually resize window in browser test, so we check CSS media queries instead
          const mediaQuery = `(max-width: ${viewport.width}px)`;
          const matches = window.matchMedia(mediaQuery).matches;
          
          details.push(`  Media query "${mediaQuery}": ${matches ? 'MATCHES' : 'no match'}`);

          // Test critical elements visibility and layout
          for (const element of CRITICAL_ELEMENTS) {
            const el = document.querySelector(element.selector);
            if (el) {
              const computedStyle = window.getComputedStyle(el);
              const isVisible = computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden';
              const hasLayout = computedStyle.width !== '0px' || computedStyle.height !== '0px';
              
              if (isVisible && hasLayout) {
                details.push(`    ‚úÖ ${element.selector}: visible`);
                testsPassed++;
              } else {
                details.push(`    ‚ùå ${element.selector}: hidden or no layout`);
                testsFailed++;
              }
            }
          }
        }

        testResults.responsive = { passed: testsPassed, failed: testsFailed, details };

        results.innerHTML = `RESPONSIVE DESIGN TEST RESULTS:
========================================
‚úÖ Passed: ${testsPassed}
‚ùå Failed: ${testsFailed}
üìà Success Rate: ${((testsPassed/(testsPassed+testsFailed))*100).toFixed(1)}%

DETAILS:
${details.join('\n')}`;

        setTestStatus('responsive', testsFailed === 0 ? 'success' : 'failed');

      } catch (error) {
        results.innerHTML = `‚ùå Error testing responsive design: ${error.message}`;
        setTestStatus('responsive', 'failed');
      }
    }

    async function testInteractions() {
      setTestStatus('interactions', 'running');
      const results = document.getElementById('interaction-results');
      results.innerHTML = 'Testing interactive elements...\n';

      try {
        let testsPassed = 0;
        let testsFailed = 0;
        let details = [];

        const interactiveElements = [
          '.hamburger-menu',
          '.tab',
          '.copy-btn', 
          '.block-link',
          '.sidebar-link',
          '.field'
        ];

        for (const selector of interactiveElements) {
          const elements = document.querySelectorAll(selector);
          if (elements.length === 0) {
            details.push(`‚ùå Interactive element not found: ${selector}`);
            testsFailed++;
            continue;
          }

          for (const el of elements) {
            // Test hover states
            const originalStyles = {
              color: window.getComputedStyle(el).color,
              backgroundColor: window.getComputedStyle(el).backgroundColor,
              cursor: window.getComputedStyle(el).cursor
            };

            // Simulate hover
            el.dispatchEvent(new MouseEvent('mouseenter', { bubbles: true }));
            
            await new Promise(resolve => setTimeout(resolve, 100)); // Wait for transition
            
            const hoverStyles = {
              color: window.getComputedStyle(el).color,
              backgroundColor: window.getComputedStyle(el).backgroundColor,
              cursor: window.getComputedStyle(el).cursor
            };

            // Check if hover state changes occurred
            const hasHoverEffects = 
              originalStyles.color !== hoverStyles.color ||
              originalStyles.backgroundColor !== hoverStyles.backgroundColor ||
              hoverStyles.cursor === 'pointer';

            if (hasHoverEffects) {
              details.push(`‚úÖ ${selector}: Has hover effects`);
              testsPassed++;
            } else {
              details.push(`‚ö†Ô∏è ${selector}: No hover effects detected`);
              // Don't count as failed since not all elements need hover effects
            }

            // Reset hover state
            el.dispatchEvent(new MouseEvent('mouseleave', { bubbles: true }));
            
            break; // Test only first element of each type
          }
        }

        // Test specific interactions
        details.push('\nüéØ Testing specific interactions:');
        
        // Test hamburger menu
        const hamburger = document.querySelector('.hamburger-menu');
        if (hamburger) {
          const isClickable = hamburger.style.cursor === 'pointer' || 
                             window.getComputedStyle(hamburger).cursor === 'pointer';
          if (isClickable) {
            details.push('‚úÖ Hamburger menu: Clickable');
            testsPassed++;
          } else {
            details.push('‚ùå Hamburger menu: Not clickable');
            testsFailed++;
          }
        }

        testResults.interactions = { passed: testsPassed, failed: testsFailed, details };

        results.innerHTML = `INTERACTIVE ELEMENTS TEST RESULTS:
========================================
‚úÖ Passed: ${testsPassed}
‚ùå Failed: ${testsFailed}
üìà Success Rate: ${testsPassed > 0 ? ((testsPassed/(testsPassed+testsFailed))*100).toFixed(1) : 100}%

DETAILS:
${details.join('\n')}`;

        setTestStatus('interactions', testsFailed === 0 ? 'success' : 'failed');

      } catch (error) {
        results.innerHTML = `‚ùå Error testing interactions: ${error.message}`;
        setTestStatus('interactions', 'failed');
      }
    }

    async function testPerformance() {
      setTestStatus('performance', 'running');
      const results = document.getElementById('performance-results');
      results.innerHTML = 'Testing performance metrics...\n';

      try {
        const details = [];
        
        // Measure CSS loading performance
        const cssFiles = Array.from(document.querySelectorAll('link[rel="stylesheet"]'));
        details.push(`üì¶ CSS Files Loaded: ${cssFiles.length}`);
        
        let totalCSSSize = 0;
        for (const css of cssFiles) {
          try {
            const response = await fetch(css.href);
            const text = await response.text();
            const sizeKB = (text.length / 1024).toFixed(1);
            totalCSSSize += text.length;
            details.push(`  ${css.href.split('/').pop()}: ${sizeKB}KB`);
          } catch (e) {
            details.push(`  ${css.href.split('/').pop()}: Unable to measure`);
          }
        }
        
        details.push(`üìä Total CSS Size: ${(totalCSSSize / 1024).toFixed(1)}KB`);

        // Measure rendering performance
        const startTime = performance.now();
        
        // Force a reflow by accessing layout properties
        const elements = document.querySelectorAll('*');
        let layoutCount = 0;
        elements.forEach(el => {
          if (el.offsetWidth > 0) layoutCount++;
        });
        
        const endTime = performance.now();
        const renderTime = (endTime - startTime).toFixed(2);
        
        details.push(`‚ö° Layout calculation time: ${renderTime}ms`);
        details.push(`üéØ Elements with layout: ${layoutCount}`);

        // Check for CSS performance issues
        const performanceIssues = [];
        if (totalCSSSize > 200 * 1024) {
          performanceIssues.push('Large CSS bundle size (>200KB)');
        }
        if (cssFiles.length > 10) {
          performanceIssues.push('Many CSS files (>10) - consider bundling');
        }
        if (renderTime > 100) {
          performanceIssues.push('Slow layout calculation (>100ms)');
        }

        const performancePassed = performanceIssues.length === 0;
        
        testResults.performance = { 
          passed: performancePassed ? 1 : 0, 
          failed: performancePassed ? 0 : 1, 
          details,
          issues: performanceIssues
        };

        results.innerHTML = `PERFORMANCE TEST RESULTS:
========================================
${performancePassed ? '‚úÖ Performance: GOOD' : '‚ö†Ô∏è Performance: Issues Found'}
${performanceIssues.length > 0 ? `\n‚ùå Issues:\n${performanceIssues.map(i => `  - ${i}`).join('\n')}` : ''}

METRICS:
${details.join('\n')}`;

        setTestStatus('performance', performancePassed ? 'success' : 'failed');

      } catch (error) {
        results.innerHTML = `‚ùå Error testing performance: ${error.message}`;
        setTestStatus('performance', 'failed');
      }
    }

    function setupVisualComparison() {
      setTestStatus('visual', 'running');
      const container = document.getElementById('visual-comparison-container');
      
      container.innerHTML = `
        <div class="element-comparison">
          <div class="comparison-box">
            <h4>Current Site (Post-Migration)</h4>
            <div class="iframe-container">
              <iframe src="../index.html" title="Current Site"></iframe>
            </div>
          </div>
          <div class="comparison-box">
            <h4>Backup Reference</h4>
            <p>Use browser dev tools to compare computed styles between the current site and any backup versions.</p>
            <button class="test-button" onclick="openDevTools()">Open Dev Tools Guide</button>
          </div>
        </div>
      `;
      
      setTestStatus('visual', 'success');
    }

    function openDevTools() {
      alert(`Dev Tools Comparison Guide:
      
1. Right-click any element ‚Üí "Inspect"
2. Check the "Computed" tab in dev tools
3. Compare key properties:
   - color, background-color
   - font-family, font-size, font-weight
   - margin, padding, border
   - width, height, display
   - flex properties
   
4. Test responsive design:
   - Toggle device toolbar (Ctrl/Cmd + Shift + M)
   - Test different viewports
   - Verify mobile hamburger menu works
   
5. Test interactions:
   - Hover over buttons/links
   - Click navigation elements
   - Verify all functionality works`);
    }

    function setTestStatus(testName, status) {
      const statusElement = document.getElementById(`status-${testName}`);
      statusElement.className = `status ${status}`;
    }

    function updateSummary(message) {
      document.getElementById('summary').innerHTML = `<h3>Test Summary</h3><p>${message}</p>`;
    }

    function generateFinalReport() {
      const totalTests = Object.values(testResults).filter(r => r !== null).length;
      const passedTests = Object.values(testResults).filter(r => r !== null && r.failed === 0).length;
      const successRate = ((passedTests / totalTests) * 100).toFixed(1);
      
      updateSummary(`
        <h3>üéâ Migration Quality Test Complete!</h3>
        <p><strong>Overall Success Rate: ${successRate}%</strong></p>
        <p>‚úÖ Tests Passed: ${passedTests} | ‚ùå Tests Failed: ${totalTests - passedTests}</p>
        <p>${successRate >= 90 ? 'üéâ Excellent migration quality!' : 
            successRate >= 70 ? '‚úÖ Good migration quality with minor issues.' : 
            '‚ö†Ô∏è Migration needs attention - review failed tests.'}</p>
      `);
    }

    function clearResults() {
      testResults = {
        computedStyles: null,
        responsive: null,
        interactions: null,
        performance: null,
        visual: null
      };
      
      document.querySelectorAll('.test-results').forEach(el => el.innerHTML = '');
      document.querySelectorAll('.status').forEach(el => el.className = 'status pending');
      document.getElementById('visual-comparison-container').innerHTML = '';
      updateSummary('Click "Run All Tests" to begin comprehensive migration quality testing.');
    }

    // Auto-run basic tests when page loads
    window.addEventListener('load', () => {
      setTimeout(() => {
        updateSummary('Page loaded successfully. Ready for testing!');
      }, 1000);
    });
  </script>
</body>
</html>